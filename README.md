# HF Speculative Decoding

> Visualizing the rejected tokens.

## Env Setup

```bash
pip install transformers==4.33.2 torch==2.5.1

# if load quant model
pip install compressed-tensors accelerate>=1.4.0
```

## Visualize Rejected Tokens

Run [visual_reject.ipynb](visual_reject.ipynb) to visualize the rejected tokens.

<span style='color: orange; font-size: 16px;'>To find out how much Weng earned, we need to</span><span style='color: gray; font-size: 16px; text-decoration: line-through;'> multiply the number of hours she worked (</span><span style='color: black; font-size: 16px;'> first</span><span style='color: orange; font-size: 16px;'> convert the</span><span style='color: gray; font-size: 16px; text-decoration: line-through;'> 50 minutes into hours. \n\nThere are 60 minutes in an hour, so </span><span style='color: black; font-size: 16px;'> time</span><span style='color: orange; font-size: 16px;'> from minutes to hours</span><span style='color: gray; font-size: 16px; text-decoration: line-through;'>. \n\nThere are 60 minutes in an hour, so 50 minutes is</span><span style='color: black; font-size: 16px;'>,</span><span style='color: orange; font-size: 16px;'> since her hourly</span><span style='color: gray; font-size: 16px; text-decoration: line-through;'> wage is given in dollars per hour. \n\nThere are 60 minutes in an hour</span><span style='color: black; font-size: 16px;'> rate</span><span style='color: orange; font-size: 16px;'> is given in dollars per hour. \n\n</span><span style='color: gray; font-size: 16px; text-decoration: line-through;'>There are 60 minutes in an hour, so 50</span><span style='color: black; font-size: 16px;'>1</span><span style='color: orange; font-size: 16px;'> hour = 60 minutes\n50 minutes = 50 / 60</span><span style='color: gray; font-size: 16px; text-decoration: line-through;'> = 5/6 hours</span><span style='color: black; font-size: 16px;'> hours</span><span style='color: orange; font-size: 16px;'></span><span style='color: gray; font-size: 16px; text-decoration: line-through;'> = 5/6 hours\n\nNow, multiply</span><span style='color: black; font-size: 16px;'>\n</span><span style='color: orange; font-size: 16px;'>50 minutes = 5/6 hour</span><span style='color: gray; font-size: 16px; text-decoration: line-through;'></span><span style='color: black; font-size: 16px;'>\n\n</span><span style='color: orange; font-size: 16px;'>Now, we multiply</span><span style='color: gray; font-size: 16px; text-decoration: line-through;'></span><span style='color: black; font-size: 16px;'> the</span><span style='color: orange; font-size: 16px;'></span><span style='color: gray; font-size: 16px; text-decoration: line-through;'> number of hours by the</span><span style='color: black; font-size: 16px;'> time</span><span style='color: orange; font-size: 16px;'></span><span style='color: gray; font-size: 16px; text-decoration: line-through;'> in hours by W</span><span style='color: black; font-size: 16px;'> worked</span><span style='color: orange; font-size: 16px;'> in hours by</span><span style='color: gray; font-size: 16px; text-decoration: line-through;'> her hourly rate:\n\n</span><span style='color: black; font-size: 16px;'> the</span><span style='color: orange; font-size: 16px;'> hourly</span><span style='color: gray; font-size: 16px; text-decoration: line-through;'> wage</span><span style='color: black; font-size: 16px;'> rate</span><span style='color: orange; font-size: 16px;'></span><span style='color: gray; font-size: 16px; text-decoration: line-through;'>:\n\n</span><span style='color: black; font-size: 16px;'> to</span><span style='color: orange; font-size: 16px;'> find</span><span style='color: gray; font-size: 16px; text-decoration: line-through;'> her</span><span style='color: black; font-size: 16px;'> the</span><span style='color: orange; font-size: 16px;'> total earnings</span><span style='color: gray; font-size: 16px; text-decoration: line-through;'>:\n\n$</span><span style='color: black; font-size: 16px;'>.\n</span><span style='color: orange; font-size: 16px;'>W</span><span style='color: gray; font-size: 16px; text-decoration: line-through;'></span><span style='color: black; font-size: 16px;'>eng</span><span style='color: orange; font-size: 16px;'>'s</span><span style='color: gray; font-size: 16px; text-decoration: line-through;'> earnings = (</span><span style='color: black; font-size: 16px;'> hourly</span><span style='color: orange; font-size: 16px;'> rate =</span><span style='color: gray; font-size: 16px; text-decoration: line-through;'></span><span style='color: black; font-size: 16px;'> $</span><span style='color: orange; font-size: 16px;'>12\nTime worked = 5/6 hour\n</span><span style='color: gray; font-size: 16px; text-decoration: line-through;'>Earnings = $</span><span style='color: black; font-size: 16px;'>Total</span><span style='color: orange; font-size: 16px;'> earnings =</span><span style='color: gray; font-size: 16px; text-decoration: line-through;'> </span><span style='color: black; font-size: 16px;'> Hour</span><span style='color: orange; font-size: 16px;'>ly rate * Time worked\nTotal earnings = $12 * 5/6\nTotal earnings =</span><span style='color: gray; font-size: 16px; text-decoration: line-through;'></span><span style='color: black; font-size: 16px;'> $</span><span style='color: orange; font-size: 16px;'>10\n\nSo, Weng earned $</span><span style='color: gray; font-size: 16px; text-decoration: line-through;'></span><span style='color: black; font-size: 16px;'>10</span>